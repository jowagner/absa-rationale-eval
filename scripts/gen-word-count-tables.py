#!/usr/bin/env python

import sys

def get_table(path):
    f = open(path, 'rt')
    token2freq_and_rank = {}
    tokens = []
    rank = 1
    while True:
        line = f.readline()
        if not line:
            break
        fields = line.split()
        assert len(fields) == 2
        freq = int(fields[0])
        token = fields[1]
        assert token not in token2freq_and_rank
        token2freq_and_rank[token] = (freq, rank)
        rank += 1
        tokens.append(token)
    f.close()
    token2freq_and_rank['ordered tokens'] = tokens
    return token2freq_and_rank

cell2table = {}
for se in 'io':
    for r in 'io':
        cell2table[(se,r)] = get_table(
                'top-words-for-r-is-%s-and-se-is-%s.tsv' %(r, se)
        )


sys.stdout.write('%% automatically generated by %s\n' %sys.argv[0])
sys.stdout.write(r"""\begin{table}
    \centering
    \small
    \begin{tabular}{l|rrrrrrrr}
    \textbf{Word} & \multicolumn{2}{c|}{\textbf{SE} $\cap$ \textbf{R}}
                  & \multicolumn{2}{c|}{\textbf{SE} $\cap$ \textbf{$\neg$R}}
                  & \multicolumn{2}{c|}{\textbf{$\neg$SE} $\cap$ \textbf{R}}
                  & \multicolumn{2}{c}{\textbf{$\neg$SE} $\cap$ \textbf{$\neg$R}} \\
""")


for block_se, nse in [
    ('i', ''),
    ('o', '$\\neg$'),
]:
    for block_r, nr in [
        ('i', ''),
        ('o', '$\\neg$'),
    ]:
        sys.stdout.write('\\hline\n')
        sys.stdout.write(r'\multicolumn{9}{l}{Top 10 \textbf{%sSE} $\cap$ \textbf{%sR} words.}\\' %(nse, nr))
        sys.stdout.write('\n\\hline\n')
        top_10 = cell2table[(block_se,block_r)]['ordered tokens'][:10]
        for token in top_10:
            sys.stdout.write('%-8s' %token)
            for column_se in 'io':
                for column_r in 'io':
                    try:
                        freq, rank = cell2table[(column_se,column_r)][token]
                        rank = '%4d' %rank
                    except KeyError:
                        freq = 0
                        rank = ' -- '
                    sys.stdout.write('& %5d & %s ' %(freq, rank))
            sys.stdout.write('\\\\\n')


sys.stdout.write(r"""    \hline
        \end{tabular}
    \caption{Frequency and rank of top 10 words in each word cloud of Table 2}
    \label{tab:wordclouds:se-and-r}
\end{table}
""")
